{"version":3,"sources":["../../src/commands/removeColumn.js"],"names":["removeColumn","table","editor","selection","path","previous","Editor","at","children","length","Transforms","insertNodes","type","text","nextPath","Path","next","nextNode","removeNodes","gridTable","getCol","xIndex","edges","start","end","nodes","match","n","startNode","endNode","col","cell","key","startCol","endCol","xLeft","xRight","topLeftCol","bottomRight","setSelection","anchor","point","originPath","focus","splitedGridTable","removedCells","reduce","p","c","cells","slice","forEach","findIndex","rows","row","minRowHeight","Infinity","rowspan","setNodes","removedGridTable","contentAfterRemove","string","idx","allColumnIsReal","minColWidth","j","isReal","colspan"],"mappings":";;;;;;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,YAAY,GAAG,SAAfA,YAAe,CAACC,KAAD,EAAQC,MAAR,EAAmB;AAAA,MAC9BC,SAD8B,GAChBD,MADgB,CAC9BC,SAD8B;AAEtC,MAAI,CAACA,SAAD,IAAc,CAACF,KAAnB,EAA0B;AAE1B,MAAMG,IAAI,GAAGH,KAAK,CAAC,CAAD,CAAlB;;AACA,MAAMI,QAAQ,GAAGC,cAAOD,QAAP,CAAgBH,MAAhB,EAAwB;AAAEK,IAAAA,EAAE,EAAEH;AAAN,GAAxB,CAAjB;;AAEA,MAAI,CAACC,QAAL,EAAe;AACb,QAAI;AACF,UAAIJ,KAAK,CAAC,CAAD,CAAL,CAASO,QAAT,CAAkB,CAAlB,EAAqBA,QAArB,CAA8BC,MAA9B,GAAuC,CAA3C,EAA8C;AAC5CC,0BAAWC,WAAX,CACET,MADF,EAEE;AAAEU,UAAAA,IAAI,EAAE,WAAR;AAAqBJ,UAAAA,QAAQ,EAAE,CAAC;AAAEK,YAAAA,IAAI,EAAE;AAAR,WAAD;AAA/B,SAFF,EAGE;AAAEN,UAAAA,EAAE,EAAE,CAAC,CAAD,EAAI,CAAJ;AAAN,SAHF;;AAMA,YAAMO,QAAQ,GAAGV,IAAI,IAAIA,IAAI,CAACK,MAAb,IAAuBM,YAAKC,IAAL,CAAUZ,IAAV,CAAxC;;AACA,YAAMa,QAAQ,GAAGH,QAAQ,IAAI,oBAAQZ,MAAR,EAAgBY,QAAhB,CAA7B;;AAEA,YAAIG,QAAQ,IAAIA,QAAQ,CAACL,IAAT,KAAkB,OAAlC,EAA2C;AACzCF,4BAAWQ,WAAX,CAAuBhB,MAAvB,EAA+B;AAAEK,YAAAA,EAAE,EAAEO;AAAN,WAA/B;AACD;;AAED;AACD;AACF,KAjBD,CAiBE,gBAAM,CAAE;AACX;;AA1BqC,sBA4BR,6BAAaZ,MAAb,EAAqBD,KAArB,CA5BQ;AAAA,MA4B9BkB,SA5B8B,iBA4B9BA,SA5B8B;AAAA,MA4BnBC,MA5BmB,iBA4BnBA,MA5BmB;;AA6BtC,MAAMC,MAAM,GAAGpB,KAAK,CAAC,CAAD,CAAL,CAASQ,MAAT,GAAkB,CAAjC;;AA7BsC,sBA+BjBH,cAAOgB,KAAP,CAAapB,MAAb,EAAqBC,SAArB,CA/BiB;AAAA;AAAA,MA+B/BoB,KA/B+B;AAAA,MA+BxBC,GA/BwB;;AAAA,sBAgClBlB,cAAOmB,KAAP,CAAavB,MAAb,EAAqB;AACvCwB,IAAAA,KAAK,EAAE,eAAAC,CAAC;AAAA,aAAIA,CAAC,CAACf,IAAF,KAAW,YAAf;AAAA,KAD+B;AAEvCL,IAAAA,EAAE,EAAEgB;AAFmC,GAArB,CAhCkB;AAAA;AAAA,MAgC/BK,SAhC+B;;AAAA,uBAqCpBtB,cAAOmB,KAAP,CAAavB,MAAb,EAAqB;AACrCwB,IAAAA,KAAK,EAAE,eAAAC,CAAC;AAAA,aAAIA,CAAC,CAACf,IAAF,KAAW,YAAf;AAAA,KAD6B;AAErCL,IAAAA,EAAE,EAAEiB;AAFiC,GAArB,CArCoB;AAAA;AAAA,MAqC/BK,OArC+B;;AAAA,gBA0CnBT,MAAM,CAAC,UAAAU,GAAG;AAAA,WAAIA,GAAG,CAACC,IAAJ,CAASC,GAAT,KAAiBJ,SAAS,CAAC,CAAD,CAAT,CAAaI,GAAlC;AAAA,GAAJ,CA1Ca;AAAA;AAAA,MA0C/BC,QA1C+B;;AAAA,iBA2CrBb,MAAM,CAAC,UAAAU,GAAG;AAAA,WAAIA,GAAG,CAACC,IAAJ,CAASC,GAAT,KAAiBH,OAAO,CAAC,CAAD,CAAP,CAAWG,GAAhC;AAAA,GAAJ,CA3Ce;AAAA;AAAA,MA2C/BE,MA3C+B;;AA6CtC,MAAMC,KAAK,GAAGF,QAAQ,CAAC7B,IAAT,CAAciB,MAAd,CAAd;AACA,MAAMe,MAAM,GAAGF,MAAM,CAAC9B,IAAP,CAAYiB,MAAZ,CAAf;AAEA,MAAMgB,UAAU,GAAGlB,SAAS,CAAC,CAAD,CAAT,CAAagB,KAAb,CAAnB;AACA,MAAMG,WAAW,GAAGnB,SAAS,CAACA,SAAS,CAACV,MAAV,GAAmB,CAApB,CAAT,CAAgC2B,MAAhC,CAApB;;AAEA1B,oBAAW6B,YAAX,CAAwBrC,MAAxB,EAAgC;AAC9BsC,IAAAA,MAAM,EAAElC,cAAOmC,KAAP,CAAavC,MAAb,EAAqBmC,UAAU,CAACK,UAAhC,CADsB;AAE9BC,IAAAA,KAAK,EAAErC,cAAOmC,KAAP,CAAavC,MAAb,EAAqBoC,WAAW,CAACI,UAAjC;AAFuB,GAAhC;;AAKA,6BAAUzC,KAAV,EAAiBC,MAAjB;;AAxDsC,uBA0DE,6BAAaA,MAAb,EAAqBD,KAArB,CA1DF;AAAA,MA0DnB2C,gBA1DmB,kBA0D9BzB,SA1D8B;;AA4DtC,MAAM0B,YAAY,GAAGD,gBAAgB,CAACE,MAAjB,CAAwB,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACrD,QAAMC,KAAK,GAAGD,CAAC,CAACE,KAAF,CAAQf,KAAR,EAAeC,MAAM,GAAG,CAAxB,CAAd;AACA,wCAAWW,CAAX,sBAAiBE,KAAjB;AACD,GAHoB,EAGlB,EAHkB,CAArB;AAKAJ,EAAAA,YAAY,CAACM,OAAb,CAAqB,UAAApB,IAAI,EAAI;AAC3BrB,sBAAWQ,WAAX,CAAuBhB,MAAvB,EAA+B;AAC7BK,MAAAA,EAAE,EAAEN,KAAK,CAAC,CAAD,CADoB;AAE7ByB,MAAAA,KAAK,EAAE,eAAAC,CAAC;AAAA,eAAIA,CAAC,CAACK,GAAF,KAAUD,IAAI,CAACA,IAAL,CAAUC,GAAxB;AAAA;AAFqB,KAA/B;AAID,GALD;;AAOAtB,oBAAWQ,WAAX,CAAuBhB,MAAvB,EAA+B;AAC7BK,IAAAA,EAAE,EAAEN,KAAK,CAAC,CAAD,CADoB;AAE7ByB,IAAAA,KAAK,EAAE,eAAAC,CAAC,EAAI;AACV,UAAIA,CAAC,CAACf,IAAF,KAAW,WAAf,EAA4B;AAC1B,eAAO,KAAP;AACD;;AAED,UAAI,CAACe,CAAC,CAACnB,QAAH,IAAemB,CAAC,CAACnB,QAAF,CAAW4C,SAAX,CAAqB,UAAArB,IAAI;AAAA,eAAIA,IAAI,CAACnB,IAAL,KAAc,YAAlB;AAAA,OAAzB,IAA2D,CAA9E,EAAiF;AAC/E,eAAO,IAAP;AACD;;AAED,aAAO,KAAP;AACD;AAZ4B,GAA/B;;AAeA,MAAMyC,IAAI,GAAG/C,cAAOmB,KAAP,CAAavB,MAAb,EAAqB;AAChCK,IAAAA,EAAE,EAAEN,KAAK,CAAC,CAAD,CADuB;AAEhCyB,IAAAA,KAAK,EAAE,eAAAC,CAAC;AAAA,aAAIA,CAAC,CAACf,IAAF,KAAW,WAAf;AAAA;AAFwB,GAArB,CAAb;;AAvFsC,6CA4FpByC,IA5FoB;AAAA;;AAAA;AAAA;AAAA,UA4F3BC,GA5F2B;AA6FpC,UAAIC,YAAY,GAAGC,QAAnB;AACAF,MAAAA,GAAG,CAAC,CAAD,CAAH,CAAO9C,QAAP,CAAgB2C,OAAhB,CAAwB,UAAApB,IAAI,EAAI;AAAA,4BACNA,IADM,CACtB0B,OADsB;AAAA,YACtBA,OADsB,8BACZ,CADY;;AAE9B,YAAIA,OAAO,GAAGF,YAAd,EAA4B;AAC1BA,UAAAA,YAAY,GAAGE,OAAf;AACD;AACF,OALD;;AAOA,UAAIF,YAAY,GAAG,CAAf,IAAoBA,YAAY,GAAGC,QAAvC,EAAiD;AAC/CF,QAAAA,GAAG,CAAC,CAAD,CAAH,CAAO9C,QAAP,CAAgB2C,OAAhB,CAAwB,UAAApB,IAAI,EAAI;AAC9BrB,4BAAWgD,QAAX,CACExD,MADF,EAEE;AACEuD,YAAAA,OAAO,EAAE,CAAC1B,IAAI,CAAC0B,OAAL,IAAgB,CAAjB,IAAsBF,YAAtB,GAAqC;AADhD,WAFF,EAKE;AACEhD,YAAAA,EAAE,EAAEN,KAAK,CAAC,CAAD,CADX;AAEEyB,YAAAA,KAAK,EAAE,eAAAC,CAAC;AAAA,qBAAIA,CAAC,CAACK,GAAF,KAAUD,IAAI,CAACC,GAAnB;AAAA;AAFV,WALF;AAUD,SAXD;AAYD;AAlHmC;;AA4FtC,wDAAwB;AAAA;AAuBvB;AAnHqC;AAAA;AAAA;AAAA;AAAA;;AAAA,uBAqHE,6BAAa9B,MAAb,EAAqBD,KAArB,CArHF;AAAA,MAqHnB0D,gBArHmB,kBAqH9BxC,SArH8B;;AAuHtC,MAAI,CAACwC,gBAAgB,CAAClD,MAAtB,EAA8B;AAC5B,QAAMmD,kBAAkB,GAAGtD,cAAOuD,MAAP,CAAc3D,MAAd,EAAsBD,KAAK,CAAC,CAAD,CAA3B,CAA3B;;AAEA,QAAI,CAAC2D,kBAAL,EAAyB;AACvBlD,wBAAWQ,WAAX,CAAuBhB,MAAvB,EAA+B;AAC7BK,QAAAA,EAAE,EAAEN,KAAK,CAAC,CAAD;AADoB,OAA/B;AAGD;;AAED;AACD;;AAED,OAAK,IAAI6D,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGH,gBAAgB,CAAC,CAAD,CAAhB,CAAoBlD,MAA5C,EAAoDqD,GAAG,IAAI,CAA3D,EAA8D;AAC5D,QAAIC,eAAe,GAAG,IAAtB;AACA,QAAIC,WAAW,GAAGR,QAAlB;;AAEA,SAAK,IAAIS,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,gBAAgB,CAAClD,MAArC,EAA6CwD,CAAC,IAAI,CAAlD,EAAqD;AACnD,UAAI,CAACN,gBAAgB,CAACM,CAAD,CAAhB,CAAoBH,GAApB,EAAyBI,MAA9B,EAAsC;AACpCH,QAAAA,eAAe,GAAG,KAAlB;AACD,OAFD,MAEO;AAAA,oCACmBJ,gBAAgB,CAACM,CAAD,CAAhB,CAAoBH,GAApB,EAAyB/B,IAD5C,CACGoC,OADH;AAAA,YACGA,OADH,sCACa,CADb;;AAEL,YAAIA,OAAO,GAAGH,WAAd,EAA2B;AACzBA,UAAAA,WAAW,GAAGG,OAAd;AACD;AACF;AACF;;AAED,QAAIJ,eAAe,IAAIC,WAAW,GAAGR,QAAjC,IAA6CQ,WAAW,GAAG,CAA/D,EAAkE;AAAA,iCACvDC,EADuD;AAAA,YAEtDlC,IAFsD,GAE7C4B,gBAAgB,CAACM,EAAD,CAAhB,CAAoBH,GAApB,CAF6C,CAEtD/B,IAFsD;;AAG9DrB,0BAAWgD,QAAX,CACExD,MADF,EAEE;AACEiE,UAAAA,OAAO,EAAE,CAACpC,IAAI,CAACoC,OAAL,IAAgB,CAAjB,IAAsBH,WAAtB,GAAoC;AAD/C,SAFF,EAKE;AACEzD,UAAAA,EAAE,EAAEN,KAAK,CAAC,CAAD,CADX;AAEEyB,UAAAA,KAAK,EAAE,eAAAC,CAAC;AAAA,mBAAIA,CAAC,CAACK,GAAF,KAAUD,IAAI,CAACC,GAAnB;AAAA;AAFV,SALF;AAH8D;;AAChE,WAAK,IAAIiC,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGN,gBAAgB,CAAClD,MAArC,EAA6CwD,EAAC,IAAI,CAAlD,EAAqD;AAAA,cAA5CA,EAA4C;AAYpD;AACF;AACF;AACF,CAlKD;;eAoKejE,Y","sourcesContent":["/* eslint-disable no-restricted-syntax */\nimport { Editor, Transforms, Path } from 'slate';\nimport { splitedTable } from '../selection';\nimport splitCell from './splitCell';\nimport { getNode } from '../utils';\n\nconst removeColumn = (table, editor) => {\n  const { selection } = editor;\n  if (!selection || !table) return;\n\n  const path = table[1];\n  const previous = Editor.previous(editor, { at: path });\n\n  if (!previous) {\n    try {\n      if (table[0].children[0].children.length < 2) {\n        Transforms.insertNodes(\n          editor,\n          { type: 'paragraph', children: [{ text: ' ' }] },\n          { at: [0, 0] },\n        );\n\n        const nextPath = path && path.length && Path.next(path);\n        const nextNode = nextPath && getNode(editor, nextPath);\n\n        if (nextNode && nextNode.type === 'table') {\n          Transforms.removeNodes(editor, { at: nextPath });\n        }\n\n        return;\n      }\n    } catch {}\n  }\n\n  const { gridTable, getCol } = splitedTable(editor, table);\n  const xIndex = table[1].length + 1;\n\n  const [start, end] = Editor.edges(editor, selection);\n  const [startNode] = Editor.nodes(editor, {\n    match: n => n.type === 'table_cell',\n    at: start,\n  });\n\n  const [endNode] = Editor.nodes(editor, {\n    match: n => n.type === 'table_cell',\n    at: end,\n  });\n\n  const [startCol] = getCol(col => col.cell.key === startNode[0].key);\n  const [endCol] = getCol(col => col.cell.key === endNode[0].key);\n\n  const xLeft = startCol.path[xIndex];\n  const xRight = endCol.path[xIndex];\n\n  const topLeftCol = gridTable[0][xLeft];\n  const bottomRight = gridTable[gridTable.length - 1][xRight];\n\n  Transforms.setSelection(editor, {\n    anchor: Editor.point(editor, topLeftCol.originPath),\n    focus: Editor.point(editor, bottomRight.originPath),\n  });\n\n  splitCell(table, editor);\n\n  const { gridTable: splitedGridTable } = splitedTable(editor, table);\n\n  const removedCells = splitedGridTable.reduce((p, c) => {\n    const cells = c.slice(xLeft, xRight + 1);\n    return [...p, ...cells];\n  }, []);\n\n  removedCells.forEach(cell => {\n    Transforms.removeNodes(editor, {\n      at: table[1],\n      match: n => n.key === cell.cell.key,\n    });\n  });\n\n  Transforms.removeNodes(editor, {\n    at: table[1],\n    match: n => {\n      if (n.type !== 'table_row') {\n        return false;\n      }\n\n      if (!n.children || n.children.findIndex(cell => cell.type === 'table_cell') < 0) {\n        return true;\n      }\n\n      return false;\n    },\n  });\n\n  const rows = Editor.nodes(editor, {\n    at: table[1],\n    match: n => n.type === 'table_row',\n  });\n\n  for (const row of rows) {\n    let minRowHeight = Infinity;\n    row[0].children.forEach(cell => {\n      const { rowspan = 1 } = cell;\n      if (rowspan < minRowHeight) {\n        minRowHeight = rowspan;\n      }\n    });\n\n    if (minRowHeight > 1 && minRowHeight < Infinity) {\n      row[0].children.forEach(cell => {\n        Transforms.setNodes(\n          editor,\n          {\n            rowspan: (cell.rowspan || 1) - minRowHeight + 1,\n          },\n          {\n            at: table[1],\n            match: n => n.key === cell.key,\n          },\n        );\n      });\n    }\n  }\n\n  const { gridTable: removedGridTable } = splitedTable(editor, table);\n\n  if (!removedGridTable.length) {\n    const contentAfterRemove = Editor.string(editor, table[1]);\n\n    if (!contentAfterRemove) {\n      Transforms.removeNodes(editor, {\n        at: table[1],\n      });\n    }\n\n    return;\n  }\n\n  for (let idx = 0; idx < removedGridTable[0].length; idx += 1) {\n    let allColumnIsReal = true;\n    let minColWidth = Infinity;\n\n    for (let j = 0; j < removedGridTable.length; j += 1) {\n      if (!removedGridTable[j][idx].isReal) {\n        allColumnIsReal = false;\n      } else {\n        const { colspan = 1 } = removedGridTable[j][idx].cell;\n        if (colspan < minColWidth) {\n          minColWidth = colspan;\n        }\n      }\n    }\n\n    if (allColumnIsReal && minColWidth < Infinity && minColWidth > 1) {\n      for (let j = 0; j < removedGridTable.length; j += 1) {\n        const { cell } = removedGridTable[j][idx];\n        Transforms.setNodes(\n          editor,\n          {\n            colspan: (cell.colspan || 1) - minColWidth + 1,\n          },\n          {\n            at: table[1],\n            match: n => n.key === cell.key,\n          },\n        );\n      }\n    }\n  }\n};\n\nexport default removeColumn;\n"],"file":"removeColumn.js"}